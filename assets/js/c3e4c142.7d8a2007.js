"use strict";(self.webpackChunkopenapi_stack=self.webpackChunkopenapi_stack||[]).push([[1911],{4137:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),d=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=d(e.components);return r.createElement(s.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=d(n),h=a,m=c["".concat(s,".").concat(h)]||c[h]||u[h]||o;return n?r.createElement(m,l(l({ref:t},p),{},{components:n})):r.createElement(m,l({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=h;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[c]="string"==typeof e?e:a,l[1]=i;for(var d=2;d<o;d++)l[d]=n[d];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},3458:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var r=n(7462),a=(n(7294),n(4137));const o={sidebar_position:4},l="Request Lifecycle & Handlers",i={unversionedId:"openapi-backend/request-lifecycle",id:"openapi-backend/request-lifecycle",title:"Request Lifecycle & Handlers",description:"OpenAPIBackend defines a rich set of hooks to intercept and control each step of the request lifecycle. Each handler receives the parsed Context object as the first argument, followed by any arguments passed to .handleRequest(), such as Express req, res, and next.",source:"@site/docs/openapi-backend/request-lifecycle.md",sourceDirName:"openapi-backend",slug:"/openapi-backend/request-lifecycle",permalink:"/docs/openapi-backend/request-lifecycle",draft:!1,editUrl:"https://github.com/openapistack/docs/edit/main/docs/openapi-backend/request-lifecycle.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Operation Handlers",permalink:"/docs/openapi-backend/operation-handlers"},next:{title:"Request validation",permalink:"/docs/openapi-backend/request-validation"}},s={},d=[{value:"Built-in Lifecycle Handlers",id:"built-in-lifecycle-handlers",level:2},{value:"<code>preRoutingHandler</code>",id:"preroutinghandler",level:3},{value:"<code>postRoutingHandler</code>",id:"postroutinghandler",level:3},{value:"<code>postSecurityHandler</code>",id:"postsecurityhandler",level:3},{value:"<code>preOperationHandler</code>",id:"preoperationhandler",level:3},{value:"<code>postResponseHandler</code>",id:"postresponsehandler",level:3},{value:"Error Handlers",id:"error-handlers",level:2},{value:"<code>notFound</code>",id:"notfound",level:3},{value:"<code>methodNotAllowed</code>",id:"methodnotallowed",level:3},{value:"<code>notImplemented</code>",id:"notimplemented",level:3},{value:"<code>unauthorizedHandler</code>",id:"unauthorizedhandler",level:3},{value:"<code>validationFail</code>",id:"validationfail",level:3}],p={toc:d},c="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(c,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"request-lifecycle--handlers"},"Request Lifecycle & Handlers"),(0,a.kt)("p",null,"OpenAPIBackend defines a rich set of hooks to intercept and control each step of the request lifecycle. Each handler receives the parsed ",(0,a.kt)("inlineCode",{parentName:"p"},"Context")," object as the first argument, followed by any arguments passed to ",(0,a.kt)("inlineCode",{parentName:"p"},".handleRequest()"),", such as Express ",(0,a.kt)("inlineCode",{parentName:"p"},"req"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"res"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"next"),"."),(0,a.kt)("h2",{id:"built-in-lifecycle-handlers"},"Built-in Lifecycle Handlers"),(0,a.kt)("p",null,"These can be registered to hook into specific steps."),(0,a.kt)("h3",{id:"preroutinghandler"},(0,a.kt)("inlineCode",{parentName:"h3"},"preRoutingHandler")),(0,a.kt)("p",null,"Called ",(0,a.kt)("strong",{parentName:"p"},"before routing"),", after parsing the request. Can be used for logging, metrics, or overriding routing behavior."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'api.register("preRoutingHandler", (c, req, res) => {\n  console.log("Request received", req.method, req.url);\n});\n')),(0,a.kt)("h3",{id:"postroutinghandler"},(0,a.kt)("inlineCode",{parentName:"h3"},"postRoutingHandler")),(0,a.kt)("p",null,"Called ",(0,a.kt)("strong",{parentName:"p"},"after routing"),", regardless of match success. Useful for metrics or auditing."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'api.register("postRoutingHandler", (c, req, res) => {\n  console.log("Matched operation:", c.operation?.operationId);\n});\n')),(0,a.kt)("h3",{id:"postsecurityhandler"},(0,a.kt)("inlineCode",{parentName:"h3"},"postSecurityHandler")),(0,a.kt)("p",null,"Called ",(0,a.kt)("strong",{parentName:"p"},"after all security handlers")," have run."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'api.register("postSecurityHandler", (c, req, res) => {\n  if (!c.security.authorized) console.warn("Unauthorized access attempt");\n});\n')),(0,a.kt)("h3",{id:"preoperationhandler"},(0,a.kt)("inlineCode",{parentName:"h3"},"preOperationHandler")),(0,a.kt)("p",null,"Called right ",(0,a.kt)("strong",{parentName:"p"},"before the operation handler"),". Can be used for setting response headers, request mutation, etc."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'api.register("preOperationHandler", (c, req, res) => {\n  res.setHeader("x-trace-id", generateTraceId());\n});\n')),(0,a.kt)("h3",{id:"postresponsehandler"},(0,a.kt)("inlineCode",{parentName:"h3"},"postResponseHandler")),(0,a.kt)("p",null,"Called ",(0,a.kt)("strong",{parentName:"p"},"after the main operation handler"),". You can use this to validate responses or mutate them."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'api.register("postResponseHandler", (c, req, res) => {\n  const result = c.api.validateResponse(c.response, c.operation);\n  if (result.errors) {\n    return res\n      .status(500)\n      .json({ error: "Invalid response", details: result.errors });\n  }\n  return res.send(c.response);\n});\n')),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"error-handlers"},"Error Handlers"),(0,a.kt)("h3",{id:"notfound"},(0,a.kt)("inlineCode",{parentName:"h3"},"notFound")),(0,a.kt)("p",null,"Called if the path doesn't match any operation."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'api.register("notFound", (c, req, res) => {\n  res.status(404).json({ error: "Route not found" });\n});\n')),(0,a.kt)("h3",{id:"methodnotallowed"},(0,a.kt)("inlineCode",{parentName:"h3"},"methodNotAllowed")),(0,a.kt)("p",null,"Called if the path matches but the method doesn't."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'api.register("methodNotAllowed", (c, req, res) => {\n  res.status(405).json({ error: "Method not allowed" });\n});\n')),(0,a.kt)("h3",{id:"notimplemented"},(0,a.kt)("inlineCode",{parentName:"h3"},"notImplemented")),(0,a.kt)("p",null,"Called if the operation is matched but ",(0,a.kt)("strong",{parentName:"p"},"no handler is registered"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'api.register("notImplemented", (c, req, res) => {\n  res.status(501).json({ error: "Not implemented" });\n});\n')),(0,a.kt)("h3",{id:"unauthorizedhandler"},(0,a.kt)("inlineCode",{parentName:"h3"},"unauthorizedHandler")),(0,a.kt)("p",null,"Called if the request does not satisfy OpenAPI security requirements."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'api.register("unauthorizedHandler", (c, req, res) => {\n  res.status(401).json({ error: "Unauthorized" });\n});\n')),(0,a.kt)("h3",{id:"validationfail"},(0,a.kt)("inlineCode",{parentName:"h3"},"validationFail")),(0,a.kt)("p",null,"Called if the request validation fails."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'api.register("validationFail", (c, req, res) => {\n  res\n    .status(400)\n    .json({ error: "Validation failed", details: c.validation.errors });\n});\n')))}u.isMDXComponent=!0}}]);